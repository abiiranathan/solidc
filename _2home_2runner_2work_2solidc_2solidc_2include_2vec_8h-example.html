<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>solidc: /home/runner/work/solidc/solidc/include/vec.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">solidc
   </div>
   <div id="projectbrief">Robust collection of general-purpose cross-platform C libraries and data structures designed for rapid and safe development in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">/home/runner/work/solidc/solidc/include/vec.h</div></div>
</div><!--header-->
<div class="contents">
<p>Test if two 3D vectors are equal within epsilon tolerance.</p>
<p>Test if two 3D vectors are equal within epsilon tolerance.Performs component-wise comparison with floating-point tolerance.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>First vector </td></tr>
    <tr><td class="paramname">b</td><td>Second vector </td></tr>
    <tr><td class="paramname">epsilon</td><td>Maximum allowed difference per component (e.g., 1e-6f) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if all components differ by less than epsilon, false otherwise</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Uses SIMD comparison for all components simultaneously. The epsilon accounts for floating-point rounding errors.</dd></dl>
<p><a class="el" href="structVec3.html" title="3D vector storage type (12 bytes, unaligned).">Vec3</a> v1 = {1.0f, 2.0f, 3.0f}; <a class="el" href="structVec3.html" title="3D vector storage type (12 bytes, unaligned).">Vec3</a> v2 = {1.00001f, 2.00001f, 3.00001f}; bool equal = vec3_equals(v1, v2, 1e-4f); // true</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef __VEC_SIMD_H__</span></div>
<div class="line"><span class="preprocessor">#define __VEC_SIMD_H__</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#ifdef __cplusplus</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="simd_8h.html">simd.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   Storage Types (Unaligned, Standard C Layout)</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a id="_a0" name="_a0"></a><a class="code hl_struct" href="structVec2.html">Vec2</a> {</div>
<div class="line">    <span class="keywordtype">float</span> <a id="a1" name="a1"></a><a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>;  </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a2" name="a2"></a><a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>;  </div>
<div class="line">} <a class="code hl_struct" href="structVec2.html">Vec2</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a id="_a3" name="_a3"></a><a class="code hl_struct" href="structVec3.html">Vec3</a> {</div>
<div class="line">    <span class="keywordtype">float</span> <a id="a4" name="a4"></a><a class="code hl_variable" href="structVec3.html#a2814580e9b9372738c0a61197ea46b51">x</a>;  </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a5" name="a5"></a><a class="code hl_variable" href="structVec3.html#abc1d241232cb04aa98217a942402ae68">y</a>;  </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a6" name="a6"></a><a class="code hl_variable" href="structVec3.html#a64f3f00cd2dd9076999eeb2f05210388">z</a>;  </div>
<div class="line">} <a class="code hl_struct" href="structVec3.html">Vec3</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a id="_a7" name="_a7"></a><a class="code hl_struct" href="structVec4.html">Vec4</a> {</div>
<div class="line">    <span class="keywordtype">float</span> <a id="a8" name="a8"></a><a class="code hl_variable" href="structVec4.html#a3d9a7d18ac661965798b0c5bc32c56df">x</a>;  </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a9" name="a9"></a><a class="code hl_variable" href="structVec4.html#a21c69aa0ef01a4ea985966c5527bbd69">y</a>;  </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a10" name="a10"></a><a class="code hl_variable" href="structVec4.html#a60d0b599c7104dd0c6e2ae0cc4cd0310">z</a>;  </div>
<div class="line">    <span class="keywordtype">float</span> <a id="a11" name="a11"></a><a class="code hl_variable" href="structVec4.html#a37bee38ceffb78ccd3875ebf82bd84b2">w</a>;  </div>
<div class="line">} <a class="code hl_struct" href="structVec4.html">Vec4</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   Compute Types (128-bit Aligned, Register Mapped)</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union </span>ALIGN(16) SimdVec2 {</div>
<div class="line">    simd_vec_t v;  </div>
<div class="line">    <span class="keywordtype">float</span> f32[4];  </div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">float</span> x;  </div>
<div class="line">        <span class="keywordtype">float</span> y;  </div>
<div class="line">    };</div>
<div class="line">} SimdVec2;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union </span>ALIGN(16) SimdVec3 {</div>
<div class="line">    simd_vec_t v;  </div>
<div class="line">    <span class="keywordtype">float</span> f32[4];  </div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">float</span> x;  </div>
<div class="line">        <span class="keywordtype">float</span> y;  </div>
<div class="line">        <span class="keywordtype">float</span> z;  </div>
<div class="line">        <span class="keywordtype">float</span> w;  </div>
<div class="line">    };</div>
<div class="line">} SimdVec3;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union </span>ALIGN(16) SimdVec4 {</div>
<div class="line">    simd_vec_t v;  </div>
<div class="line">    <span class="keywordtype">float</span> f32[4];  </div>
<div class="line">    <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">float</span> x;  </div>
<div class="line">        <span class="keywordtype">float</span> y;  </div>
<div class="line">        <span class="keywordtype">float</span> z;  </div>
<div class="line">        <span class="keywordtype">float</span> w;  </div>
<div class="line">    };</div>
<div class="line">} SimdVec4;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   SimdVec2 Operations</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> vec2_print(<span class="keyword">const</span> <a class="code hl_struct" href="structVec2.html">Vec2</a> v, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (name) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s: &quot;</span>, name);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Vec2(%f, %f)\n&quot;</span>, v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> vec3_print(<span class="keyword">const</span> <a class="code hl_struct" href="structVec3.html">Vec3</a> v, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (name) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s: &quot;</span>, name);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Vec3(%.4f, %.4f, %.4f)\n&quot;</span>, v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>, v.z);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> vec3_print_ex(<span class="keyword">const</span> <a class="code hl_struct" href="structVec3.html">Vec3</a> v, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (name) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s: &quot;</span>, name);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Vec3(%f, %f, %f)\n&quot;</span>, v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>, v.z);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> vec4_print(<span class="keyword">const</span> <a class="code hl_struct" href="structVec4.html">Vec4</a> v, <span class="keyword">const</span> <span class="keywordtype">char</span>* name) {</div>
<div class="line">    <span class="keywordflow">if</span> (name) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s: &quot;</span>, name);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Vec4(%.4f, %.4f, %.4f, %.4f)\n&quot;</span>, v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>, v.z, v.w);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_load(<a class="code hl_struct" href="structVec2.html">Vec2</a> v) {</div>
<div class="line">    SimdVec2 res;</div>
<div class="line">    <span class="comment">// Set Z/W to 0.0f to ensure dot products and other operations</span></div>
<div class="line">    <span class="comment">// don&#39;t accumulate garbage from uninitialized memory</span></div>
<div class="line">    res.v = simd_set(v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>, 0.0f, 0.0f);</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structVec2.html">Vec2</a> vec2_store(SimdVec2 v) {</div>
<div class="line">    <span class="comment">// Direct scalar access from union is cleaner than simd_store for just 2 floats</span></div>
<div class="line">    <span class="keywordflow">return</span> (<a class="code hl_struct" href="structVec2.html">Vec2</a>){v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, v.y};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_add(SimdVec2 a, SimdVec2 b) { <span class="keywordflow">return</span> (SimdVec2){.v = simd_add(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_sub(SimdVec2 a, SimdVec2 b) { <span class="keywordflow">return</span> (SimdVec2){.v = simd_sub(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_mul(SimdVec2 a, <span class="keywordtype">float</span> s) { <span class="keywordflow">return</span> (SimdVec2){.v = simd_mul(a.v, simd_set1(s))}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec2_dot(SimdVec2 a, SimdVec2 b) {</div>
<div class="line">    <span class="comment">// 2D dot can use 3D dot if Z=0 (which we ensure on load),</span></div>
<div class="line">    <span class="comment">// but scalar extraction is more efficient for just 2 multiplies.</span></div>
<div class="line">    <span class="comment">// SIMD multiply then scalar extraction:</span></div>
<div class="line">    <span class="comment">// simd_vec_t mul = simd_mul(a.v, b.v);</span></div>
<div class="line">    <span class="comment">// However, direct scalar access is simpler:</span></div>
<div class="line">    <span class="keywordflow">return</span> (a.x * b.x) + (a.y * b.y);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec2_length_sq(SimdVec2 v) { <span class="keywordflow">return</span> vec2_dot(v, v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec2_length(SimdVec2 v) { <span class="keywordflow">return</span> sqrtf(vec2_length_sq(v)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_normalize(SimdVec2 v) {</div>
<div class="line">    <span class="comment">// Reuse simd_normalize3 since Z=0. This uses rsqrt or proper sqrt</span></div>
<div class="line">    <span class="comment">// depending on platform and gives us proper normalization.</span></div>
<div class="line">    <span class="keywordflow">return</span> (SimdVec2){.v = simd_normalize3(v.v)};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_rotate(SimdVec2 v, <span class="keywordtype">float</span> angle) {</div>
<div class="line">    <span class="keywordtype">float</span> c = cosf(angle);</div>
<div class="line">    <span class="keywordtype">float</span> s = sinf(angle);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Broadcast components to all lanes for vectorized linear combination</span></div>
<div class="line">    simd_vec_t x = simd_splat_x(v.v);</div>
<div class="line">    simd_vec_t y = simd_splat_y(v.v);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Rotation matrix columns:</span></div>
<div class="line">    <span class="comment">// col0 = {c, s, 0, 0}  - maps X component</span></div>
<div class="line">    <span class="comment">// col1 = {-s, c, 0, 0} - maps Y component</span></div>
<div class="line">    simd_vec_t c0 = simd_set(c, s, 0.0f, 0.0f);</div>
<div class="line">    simd_vec_t c1 = simd_set(-s, c, 0.0f, 0.0f);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// result = x * col0 + y * col1</span></div>
<div class="line">    <span class="keywordflow">return</span> (SimdVec2){.v = simd_add(simd_mul(x, c0), simd_mul(y, c1))};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec2_distance_sq(SimdVec2 a, SimdVec2 b) { <span class="keywordflow">return</span> vec2_length_sq(vec2_sub(b, a)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec2_distance(SimdVec2 a, SimdVec2 b) { <span class="keywordflow">return</span> sqrtf(vec2_distance_sq(a, b)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_lerp(SimdVec2 a, SimdVec2 b, <span class="keywordtype">float</span> t) {</div>
<div class="line">    <span class="comment">// Result = a + (b - a) * t</span></div>
<div class="line">    SimdVec2 diff = vec2_sub(b, a);</div>
<div class="line">    SimdVec2 part = vec2_mul(diff, t);</div>
<div class="line">    <span class="keywordflow">return</span> vec2_add(a, part);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_project(SimdVec2 a, SimdVec2 b) {</div>
<div class="line">    <span class="keywordtype">float</span> b_len_sq = vec2_length_sq(b);</div>
<div class="line">    <span class="keywordflow">if</span> (b_len_sq &lt; 1e-6f) <span class="keywordflow">return</span> (SimdVec2){{0}};  <span class="comment">// Handle zero-length B</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> scale = vec2_dot(a, b) / b_len_sq;</div>
<div class="line">    <span class="keywordflow">return</span> vec2_mul(b, scale);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_reject(SimdVec2 a, SimdVec2 b) { <span class="keywordflow">return</span> vec2_sub(a, vec2_project(a, b)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec2 vec2_perpendicular(SimdVec2 v) {</div>
<div class="line">    <span class="comment">// 2D Perp is just swapping X and Y and negating one.</span></div>
<div class="line">    <span class="comment">// We can use simd_set for clarity or swizzle macros if defined.</span></div>
<div class="line">    <span class="comment">// X&#39; = -Y, Y&#39; = X</span></div>
<div class="line">    <span class="keywordflow">return</span> (SimdVec2){.v = simd_set(-v.y, v.x, 0.0f, 0.0f)};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   SimdVec3 Operations</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_load(<a class="code hl_struct" href="structVec3.html">Vec3</a> v) {</div>
<div class="line">    SimdVec3 res;</div>
<div class="line">    <span class="comment">// Set W to 0.0f to make accidental dot4/hadd operations safe</span></div>
<div class="line">    res.v = simd_set(v.<a class="code hl_variable" href="structVec3.html#a2814580e9b9372738c0a61197ea46b51">x</a>, v.<a class="code hl_variable" href="structVec3.html#abc1d241232cb04aa98217a942402ae68">y</a>, v.<a class="code hl_variable" href="structVec3.html#a64f3f00cd2dd9076999eeb2f05210388">z</a>, 0.0f);</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structVec3.html">Vec3</a> vec3_store(SimdVec3 v) { <span class="keywordflow">return</span> (<a class="code hl_struct" href="structVec3.html">Vec3</a>){v.<a class="code hl_variable" href="structVec3.html#a2814580e9b9372738c0a61197ea46b51">x</a>, v.y, v.z}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_add(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_add(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_sub(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_sub(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_mul(SimdVec3 a, <span class="keywordtype">float</span> s) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_mul(a.v, simd_set1(s))}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_scale(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_mul(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec3_dot(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> simd_dot3(a.v, b.v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_cross(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_cross(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec3_length_sq(SimdVec3 v) { <span class="keywordflow">return</span> simd_length_sq3(v.v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec3_length(SimdVec3 v) { <span class="keywordflow">return</span> simd_length3(v.v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_normalize(SimdVec3 v) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_normalize3(v.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_normalize_fast(SimdVec3 v) { <span class="keywordflow">return</span> (SimdVec3){.v = simd_normalize3_fast(v.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec3_distance_sq(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> vec3_length_sq(vec3_sub(b, a)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec3_distance(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> sqrtf(vec3_distance_sq(a, b)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_lerp(SimdVec3 a, SimdVec3 b, <span class="keywordtype">float</span> t) {</div>
<div class="line">    SimdVec3 diff = vec3_sub(b, a);</div>
<div class="line">    <span class="keywordflow">return</span> vec3_add(a, vec3_mul(diff, t));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_project(SimdVec3 a, SimdVec3 b) {</div>
<div class="line">    <span class="keywordtype">float</span> b_len_sq = vec3_length_sq(b);</div>
<div class="line">    <span class="keywordflow">if</span> (b_len_sq &lt; 1e-6f) <span class="keywordflow">return</span> (SimdVec3){{0}};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> scale = vec3_dot(a, b) / b_len_sq;</div>
<div class="line">    <span class="keywordflow">return</span> vec3_mul(b, scale);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_reject(SimdVec3 a, SimdVec3 b) { <span class="keywordflow">return</span> vec3_sub(a, vec3_project(a, b)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec3 vec3_perpendicular(SimdVec3 v) {</div>
<div class="line">    <span class="comment">// Strategy: Cross v with the world axis it is LEAST parallel to.</span></div>
<div class="line">    <span class="comment">// If |v.y| &lt; 0.9, cross with Y-axis (0,1,0).</span></div>
<div class="line">    <span class="comment">// Otherwise cross with X-axis (1,0,0).</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We access scalars here because conditional logic is cleaner in scalar</span></div>
<div class="line">    <span class="comment">// than trying to construct a branchless SIMD mask for this specific logic.</span></div>
<div class="line">    SimdVec3 axis;</div>
<div class="line">    <span class="keywordflow">if</span> (fabsf(v.y) &lt; 0.99f) {</div>
<div class="line">        axis = vec3_load((<a class="code hl_struct" href="structVec3.html">Vec3</a>){0.0f, 1.0f, 0.0f});  <span class="comment">// Up</span></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        axis = vec3_load((<a class="code hl_struct" href="structVec3.html">Vec3</a>){1.0f, 0.0f, 0.0f});  <span class="comment">// Right</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> vec3_normalize(vec3_cross(v, axis));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   SimdVec4 Operations</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_load(<a class="code hl_struct" href="structVec4.html">Vec4</a> v) {</div>
<div class="line">    SimdVec4 res;</div>
<div class="line">    res.v = simd_set(v.<a class="code hl_variable" href="structVec4.html#a3d9a7d18ac661965798b0c5bc32c56df">x</a>, v.<a class="code hl_variable" href="structVec4.html#a21c69aa0ef01a4ea985966c5527bbd69">y</a>, v.<a class="code hl_variable" href="structVec4.html#a60d0b599c7104dd0c6e2ae0cc4cd0310">z</a>, v.<a class="code hl_variable" href="structVec4.html#a37bee38ceffb78ccd3875ebf82bd84b2">w</a>);</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code hl_struct" href="structVec4.html">Vec4</a> vec4_store(SimdVec4 v) { <span class="keywordflow">return</span> (<a class="code hl_struct" href="structVec4.html">Vec4</a>){v.<a class="code hl_variable" href="structVec4.html#a3d9a7d18ac661965798b0c5bc32c56df">x</a>, v.y, v.z, v.w}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec4_length(SimdVec4 v) { <span class="keywordflow">return</span> simd_length4(v.v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec4_length_sq(SimdVec4 v) { <span class="keywordflow">return</span> simd_length_sq4(v.v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_add(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> (SimdVec4){.v = simd_add(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_sub(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> (SimdVec4){.v = simd_sub(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_mul(SimdVec4 a, <span class="keywordtype">float</span> s) { <span class="keywordflow">return</span> (SimdVec4){.v = simd_mul(a.v, simd_set1(s))}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_div(SimdVec4 a, <span class="keywordtype">float</span> s) {</div>
<div class="line">    <span class="comment">// Check against a small epsilon to avoid Division by Zero</span></div>
<div class="line">    <span class="keywordflow">if</span> (fabsf(s) &lt; 1e-8f) {</div>
<div class="line">        <span class="keywordflow">return</span> (SimdVec4){.v = simd_set_zero()};</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Multiplication by reciprocal is faster than division</span></div>
<div class="line">    <span class="keywordflow">return</span> vec4_mul(a, 1.0f / s);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec4_dot(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> simd_dot4(a.v, b.v); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_scale(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> (SimdVec4){.v = simd_mul(a.v, b.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_normalize(SimdVec4 a) { <span class="keywordflow">return</span> (SimdVec4){.v = simd_normalize4(a.v)}; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   Rotations (Optimized)</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_rotate_x(SimdVec4 v, <span class="keywordtype">float</span> angle) {</div>
<div class="line">    <span class="keywordtype">float</span> c = cosf(angle);</div>
<div class="line">    <span class="keywordtype">float</span> s = sinf(angle);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Apply rotation matrix to Y and Z components</span></div>
<div class="line">    <span class="comment">// X and W are preserved</span></div>
<div class="line">    <span class="keywordtype">float</span> ny = v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a> * c - v.z * s;</div>
<div class="line">    <span class="keywordtype">float</span> nz = v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a> * s + v.z * c;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (SimdVec4){.v = simd_set(v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a>, ny, nz, v.w)};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_rotate_y(SimdVec4 v, <span class="keywordtype">float</span> angle) {</div>
<div class="line">    <span class="keywordtype">float</span> c = cosf(angle);</div>
<div class="line">    <span class="keywordtype">float</span> s = sinf(angle);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Apply rotation matrix to X and Z components</span></div>
<div class="line">    <span class="comment">// Y and W are preserved</span></div>
<div class="line">    <span class="keywordtype">float</span> nx = v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a> * c + v.z * s;</div>
<div class="line">    <span class="keywordtype">float</span> nz = -v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a> * s + v.z * c;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (SimdVec4){.v = simd_set(nx, v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a>, nz, v.w)};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_rotate_z(SimdVec4 v, <span class="keywordtype">float</span> angle) {</div>
<div class="line">    <span class="keywordtype">float</span> c = cosf(angle);</div>
<div class="line">    <span class="keywordtype">float</span> s = sinf(angle);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Apply rotation matrix to X and Y components</span></div>
<div class="line">    <span class="comment">// Z and W are preserved</span></div>
<div class="line">    <span class="keywordtype">float</span> nx = v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a> * c - v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a> * s;</div>
<div class="line">    <span class="keywordtype">float</span> ny = v.<a class="code hl_variable" href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">x</a> * s + v.<a class="code hl_variable" href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">y</a> * c;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (SimdVec4){.v = simd_set(nx, ny, v.z, v.w)};</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ==================================================</span></div>
<div class="line"><span class="comment">   Utility Functions</span></div>
<div class="line"><span class="comment">   ================================================== */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> vec3_equals(<a class="code hl_struct" href="structVec3.html">Vec3</a> a, <a class="code hl_struct" href="structVec3.html">Vec3</a> b, <span class="keywordtype">float</span> epsilon) {</div>
<div class="line">    <span class="comment">// Load with matching Z/W handling to ensure comparison works</span></div>
<div class="line">    SimdVec3 sa = vec3_load(a);</div>
<div class="line">    SimdVec3 sb = vec3_load(b);</div>
<div class="line">    <span class="keywordflow">return</span> simd_equals_eps(sa.v, sb.v, epsilon);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> vec4_equals(<a class="code hl_struct" href="structVec4.html">Vec4</a> a, <a class="code hl_struct" href="structVec4.html">Vec4</a> b, <span class="keywordtype">float</span> epsilon) {</div>
<div class="line">    SimdVec4 sa = vec4_load(a);</div>
<div class="line">    SimdVec4 sb = vec4_load(b);</div>
<div class="line">    <span class="keywordflow">return</span> simd_equals_eps(sa.v, sb.v, epsilon);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec4_distance_sq(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> vec4_length_sq(vec4_sub(b, a)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">float</span> vec4_distance(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> sqrtf(vec4_distance_sq(a, b)); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_lerp(SimdVec4 a, SimdVec4 b, <span class="keywordtype">float</span> t) {</div>
<div class="line">    SimdVec4 diff = vec4_sub(b, a);</div>
<div class="line">    <span class="keywordflow">return</span> vec4_add(a, vec4_mul(diff, t));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_project(SimdVec4 a, SimdVec4 b) {</div>
<div class="line">    <span class="keywordtype">float</span> b_len_sq = vec4_length_sq(b);</div>
<div class="line">    <span class="keywordflow">if</span> (b_len_sq &lt; 1e-6f) <span class="keywordflow">return</span> (SimdVec4){{0}};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> scale = vec4_dot(a, b) / b_len_sq;</div>
<div class="line">    <span class="keywordflow">return</span> vec4_mul(b, scale);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SimdVec4 vec4_reject(SimdVec4 a, SimdVec4 b) { <span class="keywordflow">return</span> vec4_sub(a, vec4_project(a, b)); }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef __cplusplus</span></div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">// __VEC_SIMD_H__</span></div>
<div class="ttc" id="asimd_8h_html"><div class="ttname"><a href="simd_8h.html">simd.h</a></div><div class="ttdoc">Portable Single Instruction Multiple Data (SIMD) Intrinsics Wrapper.</div></div>
<div class="ttc" id="astructVec2_html"><div class="ttname"><a href="structVec2.html">Vec2</a></div><div class="ttdoc">2D vector storage type (8 bytes, unaligned).</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00052">vec.h:52</a></div></div>
<div class="ttc" id="astructVec2_html_a30543787e62f6d915543cf1dfb04c094"><div class="ttname"><a href="structVec2.html#a30543787e62f6d915543cf1dfb04c094">Vec2::y</a></div><div class="ttdeci">float y</div><div class="ttdoc">Y component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00054">vec.h:54</a></div></div>
<div class="ttc" id="astructVec2_html_adf8ee322d4b4bcc04146762c018d731f"><div class="ttname"><a href="structVec2.html#adf8ee322d4b4bcc04146762c018d731f">Vec2::x</a></div><div class="ttdeci">float x</div><div class="ttdoc">X component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00053">vec.h:53</a></div></div>
<div class="ttc" id="astructVec3_html"><div class="ttname"><a href="structVec3.html">Vec3</a></div><div class="ttdoc">3D vector storage type (12 bytes, unaligned).</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00063">vec.h:63</a></div></div>
<div class="ttc" id="astructVec3_html_a2814580e9b9372738c0a61197ea46b51"><div class="ttname"><a href="structVec3.html#a2814580e9b9372738c0a61197ea46b51">Vec3::x</a></div><div class="ttdeci">float x</div><div class="ttdoc">X component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00064">vec.h:64</a></div></div>
<div class="ttc" id="astructVec3_html_a64f3f00cd2dd9076999eeb2f05210388"><div class="ttname"><a href="structVec3.html#a64f3f00cd2dd9076999eeb2f05210388">Vec3::z</a></div><div class="ttdeci">float z</div><div class="ttdoc">Z component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00066">vec.h:66</a></div></div>
<div class="ttc" id="astructVec3_html_abc1d241232cb04aa98217a942402ae68"><div class="ttname"><a href="structVec3.html#abc1d241232cb04aa98217a942402ae68">Vec3::y</a></div><div class="ttdeci">float y</div><div class="ttdoc">Y component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00065">vec.h:65</a></div></div>
<div class="ttc" id="astructVec4_html"><div class="ttname"><a href="structVec4.html">Vec4</a></div><div class="ttdoc">4D vector storage type (16 bytes, naturally aligned).</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00075">vec.h:75</a></div></div>
<div class="ttc" id="astructVec4_html_a21c69aa0ef01a4ea985966c5527bbd69"><div class="ttname"><a href="structVec4.html#a21c69aa0ef01a4ea985966c5527bbd69">Vec4::y</a></div><div class="ttdeci">float y</div><div class="ttdoc">Y component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00077">vec.h:77</a></div></div>
<div class="ttc" id="astructVec4_html_a37bee38ceffb78ccd3875ebf82bd84b2"><div class="ttname"><a href="structVec4.html#a37bee38ceffb78ccd3875ebf82bd84b2">Vec4::w</a></div><div class="ttdeci">float w</div><div class="ttdoc">W component (also used for homogeneous coordinates)</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00079">vec.h:79</a></div></div>
<div class="ttc" id="astructVec4_html_a3d9a7d18ac661965798b0c5bc32c56df"><div class="ttname"><a href="structVec4.html#a3d9a7d18ac661965798b0c5bc32c56df">Vec4::x</a></div><div class="ttdeci">float x</div><div class="ttdoc">X component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00076">vec.h:76</a></div></div>
<div class="ttc" id="astructVec4_html_a60d0b599c7104dd0c6e2ae0cc4cd0310"><div class="ttname"><a href="structVec4.html#a60d0b599c7104dd0c6e2ae0cc4cd0310">Vec4::z</a></div><div class="ttdeci">float z</div><div class="ttdoc">Z component.</div><div class="ttdef"><b>Definition</b> <a href="vec_8h_source.html#l00078">vec.h:78</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
